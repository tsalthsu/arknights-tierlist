<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arknights Skin Tier List</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        /* --- CSS ìŠ¤íƒ€ì¼ --- */
        :root {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --panel-bg: #222;
            --item-bg: #2b2b2b;
            --border-color: #444;
            --card-bg: #333;
            --card-border: #555;
            --modal-bg: #2a2a2a;
            --modal-overlay: rgba(0, 0, 0, 0.7);
            --shadow: rgba(0,0,0,0.5);
        }
        [data-theme="light"] {
            --bg-color: #f0f2f5;
            --text-color: #333333;
            --panel-bg: #ffffff;
            --item-bg: #e4e6eb;
            --border-color: #ccc;
            --card-bg: #fff;
            --card-border: #bbb;
            --modal-bg: #fff;
            --modal-overlay: rgba(0, 0, 0, 0.3);
            --shadow: rgba(0,0,0,0.1);
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background 0.3s, color 0.3s;
        }
        .header-area {
            position: relative;
            width: 100%;
            max-width: 1200px;
            text-align: center;
            margin-bottom: 20px;
        }
        h1 {
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin: 0 0 20px 0;
        }
        .lang-selector { position: absolute; top: 0; right: 0; }
        select {
            background-color: var(--panel-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .controls { margin-bottom: 20px; display: flex; gap: 10px; }
        .btn {
            background-color: var(--panel-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 10px 25px;
            cursor: pointer;
            font-size: 1rem;
            border-radius: 4px;
            font-weight: bold;
            transition: all 0.2s;
        }
        .btn:hover { filter: brightness(1.2); transform: translateY(-2px); }
        .btn-submit { background-color: #1976d2; color: white; border-color: #0d47a1; }
        .btn-reset { background-color: #c62828; color: white; border-color: #b71c1c; }
        
        .tier-container { width: 100%; max-width: 1200px; display: flex; flex-direction: column; gap: 10px; margin-bottom: 50px; }
        .tier-row { display: flex; min-height: 160px; background-color: var(--panel-bg); border: 1px solid var(--border-color); }
        .tier-label {
            width: 100px; display: flex; align-items: center; justify-content: center;
            font-size: 2.5rem; font-weight: 900; flex-shrink: 0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5); color: #333; user-select: none;
        }
        .tier-content {
            flex-grow: 1; padding: 10px; display: flex; flex-wrap: wrap; gap: 10px;
            background-color: var(--item-bg); align-content: flex-start; transition: background 0.3s;
        }
        .pool-section {
            width: 100%; max-width: 1200px; border: 2px dashed var(--border-color);
            padding: 20px; background-color: var(--panel-bg); transition: background 0.3s;
        }
        .pool-title { margin-top: 0; margin-bottom: 15px; color: #888; }
        .item-pool { display: flex; flex-wrap: wrap; gap: 15px; min-height: 200px; }
        .skin-card {
            width: 100px; height: 180px; background-color: var(--card-bg);
            border: 1px solid var(--card-border); cursor: grab; position: relative;
            overflow: hidden; transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 5px var(--shadow);
        }
        .skin-card img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
        .skin-card:hover {
            transform: translateY(-7px) scale(1.02); box-shadow: 0 10px 20px var(--shadow);
            border-color: var(--text-color); z-index: 10;
        }
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--modal-overlay); display: none;
            justify-content: center; align-items: center; z-index: 1000;
            backdrop-filter: blur(3px);
        }
        .modal-box {
            background-color: var(--modal-bg); color: var(--text-color);
            border: 1px solid var(--border-color); padding: 25px; border-radius: 8px;
            width: 320px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .modal-msg { margin-bottom: 20px; font-size: 1.1rem; line-height: 1.5; }
        .modal-actions { display: flex; justify-content: center; gap: 10px; }
        .modal-btn { padding: 10px 20px; border-radius: 4px; border: none; cursor: pointer; font-weight: bold; }
        .modal-btn.confirm { background-color: #1976d2; color: white; }
        .modal-btn.cancel { background-color: var(--border-color); color: var(--text-color); }
        .theme-toggle {
            position: fixed; bottom: 20px; left: 20px; width: 50px; height: 50px;
            border-radius: 50%; background-color: var(--panel-bg);
            border: 2px solid var(--border-color); color: var(--text-color);
            font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 10px var(--shadow);
            z-index: 100; display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

    <div class="header-area">
        <h1 id="txt-title">Arknights Skin Tier List</h1>
        <div class="lang-selector">
            <select id="langSelect" onchange="window.changeLanguage(this.value)">
                <option value="ko">í•œêµ­ì–´</option>
                <option value="en">English</option>
                <option value="jp">æ—¥æœ¬èª</option>
                <option value="cn">ä¸­æ–‡</option>
            </select>
        </div>
    </div>

    <div class="controls">
        <button class="btn btn-submit" onclick="window.submitTierList()" id="btn-submit">Submit</button>
        <button class="btn btn-reset" onclick="window.tryReset()" id="btn-reset">Reset</button>
    </div>

    <div class="tier-container" id="tier-container"></div>

    <div class="pool-section">
        <h3 class="pool-title" id="txt-pool">Unranked Skins</h3>
        <div class="item-pool" id="pool"></div>
    </div>

    <button class="theme-toggle" onclick="window.toggleTheme()">
        <span id="theme-icon">â˜€ï¸</span>
    </button>

    <div class="modal-overlay" id="confirmModal">
        <div class="modal-box">
            <div class="modal-msg" id="modal-msg">Message</div>
            <div class="modal-actions">
                <button class="modal-btn confirm" id="modal-yes">Yes</button>
                <button class="modal-btn cancel" onclick="window.closeModal()" id="modal-no">No</button>
            </div>
        </div>
    </div>

    <script type="module">
        // -----------------------------------------------------------
        // ğŸ”¥ Firebase ì„¤ì •
        // -----------------------------------------------------------
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC7z3JsiRzPSXnOdxtazbtq2J41oORv9og",
            authDomain: "skin-cad0f.firebaseapp.com",
            projectId: "skin-cad0f",
            storageBucket: "skin-cad0f.firebasestorage.app",
            messagingSenderId: "343015548730",
            appId: "1:343015548730:web:d65503a46d1fbabbf59203",
            measurementId: "G-P1NC2B9TE5"
        };

        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // -----------------------------------------------------------
        // ë¡œì§ ì‹œì‘
        // -----------------------------------------------------------
        const pathPrefix = "img/"; 
        const totalImages = 110; 
        const fixedTiers = [
            { label: 'S', color: '#ff7f7f' },
            { label: 'A', color: '#ffbf7f' },
            { label: 'B', color: '#ffff7f' },
            { label: 'C', color: '#7fff7f' },
            { label: 'D', color: '#7fbfff' },
            { label: 'F', color: '#bfbfbf' }
        ];

        const i18n = {
            ko: {
                title: "ëª…ì¼ë°©ì£¼ ìŠ¤í‚¨ í‹°ì–´í‘œ",
                submit: "ì œì¶œí•˜ê¸°",
                reset: "ì´ˆê¸°í™”",
                pool: "ëŒ€ê¸°ì—´ (ë“œë˜ê·¸í•˜ì—¬ ì´ë™)",
                confirmReset: "ëª¨ë“  ë°°ì¹˜ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.<br>ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                submitFail: "ìµœì†Œ 5ê°œ ì´ìƒì˜ ì•„ì´í…œì„<br>í‹°ì–´í‘œì— ë°°ì¹˜í•´ì£¼ì„¸ìš”!",
                submitSuccess: "ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!<br>ê°¤ëŸ¬ë¦¬ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.",
                saveError: "ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                yes: "í™•ì¸",
                no: "ì·¨ì†Œ"
            },
            en: {
                title: "Arknights Skin Tier List",
                submit: "Submit",
                reset: "Reset",
                pool: "Unranked Skins",
                confirmReset: "All placements will be reset.<br>Proceed?",
                submitFail: "Please place at least 5 items<br>to submit.",
                submitSuccess: "Saved successfully!<br>Redirecting to gallery...",
                saveError: "Error saving data.<br>Please try again later.",
                yes: "Yes",
                no: "No"
            },
            jp: {
                title: "ã‚¢ãƒ¼ã‚¯ãƒŠã‚¤ãƒ„ ã‚³ãƒ¼ãƒ‡ Tierè¡¨",
                submit: "æå‡ºã™ã‚‹",
                reset: "ãƒªã‚»ãƒƒãƒˆ",
                pool: "æœªé…ç½®ãƒªã‚¹ãƒˆ",
                confirmReset: "å…¨ã¦ã®é…ç½®ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚<br>ç¶šã‘ã¾ã™ã‹ï¼Ÿ",
                submitFail: "5ã¤ä»¥ä¸Šã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’<br>é…ç½®ã—ã¦ãã ã•ã„ã€‚",
                submitSuccess: "ä¿å­˜ã•ã‚Œã¾ã—ãŸï¼<br>ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒšãƒ¼ã‚¸ã¸ç§»å‹•ã—ã¾ã™ã€‚",
                saveError: "ä¿å­˜ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",
                yes: "ç¢ºèª",
                no: "ã‚­ãƒ£ãƒ³ã‚»ãƒ«"
            },
            cn: {
                title: "æ˜æ—¥æ–¹èˆŸ æ—¶è£… æ¢¯é˜Ÿæ¦œ",
                submit: "æäº¤",
                reset: "é‡ç½®",
                pool: "æœªæ’åçš®è‚¤",
                confirmReset: "æ‰€æœ‰å¸ƒå±€å°†è¢«é‡ç½®ã€‚<br>æ˜¯å¦ç»§ç»­ï¼Ÿ",
                submitFail: "è¯·è‡³å°‘æ”¾ç½®5ä¸ªç‰©å“<br>ä»¥è¿›è¡Œæäº¤ã€‚",
                submitSuccess: "ä¿å­˜æˆåŠŸï¼<br>å³å°†è·³è½¬åˆ°ç”»å»Šé¡µé¢ã€‚",
                saveError: "ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚",
                yes: "ç¡®è®¤",
                no: "å–æ¶ˆ"
            }
        };

        let currentLang = 'ko';

        window.onload = function() {
            window.detectLanguage();
            loadImages();
            createFixedTiers();
            window.applyTheme();
        };

        // â˜…â˜…â˜… ì œì¶œ ê¸°ëŠ¥ (ìˆ˜ì •ë¨: ê°¤ëŸ¬ë¦¬ ì´ë™) â˜…â˜…â˜…
        window.submitTierList = async function() {
            const resultData = {
                timestamp: new Date().toISOString(),
                tiers: {}
            };
            
            let totalPlacedCount = 0;

            document.querySelectorAll('.tier-row').forEach(row => {
                const tierName = row.getAttribute('data-tier');
                const items = [];
                const cards = row.querySelectorAll('.skin-card');
                cards.forEach(card => {
                    const skinId = card.getAttribute('data-id');
                    items.push(skinId);
                    totalPlacedCount++;
                });
                resultData.tiers[tierName] = items;
            });

            if (totalPlacedCount < 5) {
                window.showModal(i18n[currentLang].submitFail, null, false);
                return;
            }

            // ë¡œë”© í‘œì‹œ
            const submitBtn = document.getElementById('btn-submit');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = "Saving...";
            submitBtn.disabled = true;

            try {
                // Firestore ì €ì¥
                await addDoc(collection(db, "tier_results"), resultData);
                
                // ì„±ê³µ ëª¨ë‹¬ ë„ìš°ê¸°
                window.showModal(i18n[currentLang].submitSuccess, () => {
                    // [ìˆ˜ì •ëœ ë¶€ë¶„] í™•ì¸ ë²„íŠ¼ ëˆ„ë¥´ë©´ ê°¤ëŸ¬ë¦¬ í˜ì´ì§€ë¡œ ì´ë™
                    window.location.href = 'gallery.html';
                }, false);

            } catch (e) {
                console.error("Error adding document: ", e);
                window.showModal(i18n[currentLang].saveError + "<br>(" + e.message + ")", null, false);
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // --- ê¸°íƒ€ ê¸°ëŠ¥ í•¨ìˆ˜ë“¤ ---
        window.detectLanguage = function() {
            const userLang = navigator.language.slice(0, 2);
            if (['ko', 'en', 'ja', 'zh'].includes(userLang)) {
                currentLang = (userLang === 'ja') ? 'jp' : (userLang === 'zh') ? 'cn' : userLang;
            } else {
                currentLang = 'en';
            }
            document.getElementById('langSelect').value = currentLang;
            window.updateText();
        }

        window.changeLanguage = function(lang) {
            currentLang = lang;
            window.updateText();
        }

        window.updateText = function() {
            const t = i18n[currentLang];
            document.getElementById('txt-title').textContent = t.title;
            document.getElementById('btn-submit').textContent = t.submit;
            document.getElementById('btn-reset').textContent = t.reset;
            document.getElementById('txt-pool').textContent = t.pool;
            document.getElementById('modal-yes').textContent = t.yes;
            document.getElementById('modal-no').textContent = t.no;
        }

        function loadImages() {
            const pool = document.getElementById('pool');
            pool.innerHTML = '';
            for (let i = 1; i <= totalImages; i++) {
                const number = String(i).padStart(3, '0');
                const card = document.createElement('div');
                card.className = 'skin-card';
                card.setAttribute('data-id', `skin_${number}.png`);
                card.innerHTML = `<img src="${pathPrefix}skin_${number}.png" onerror="this.parentElement.style.display='none'">`;
                pool.appendChild(card);
            }
            new Sortable(pool, { group: 'shared', animation: 150 });
        }

        function createFixedTiers() {
            const container = document.getElementById('tier-container');
            container.innerHTML = '';
            fixedTiers.forEach(tier => {
                const row = document.createElement('div');
                row.className = 'tier-row';
                row.setAttribute('data-tier', tier.label);
                const label = document.createElement('div');
                label.className = 'tier-label';
                label.textContent = tier.label;
                label.style.backgroundColor = tier.color;
                const content = document.createElement('div');
                content.className = 'tier-content';
                content.id = `tier-${tier.label}`;
                row.appendChild(label);
                row.appendChild(content);
                container.appendChild(row);
                new Sortable(content, { group: 'shared', animation: 150 });
            });
        }

        window.tryReset = function() {
            const itemsInTiers = document.querySelectorAll('.tier-content .skin-card');
            if (itemsInTiers.length > 0) {
                window.showModal(i18n[currentLang].confirmReset, () => {
                    const pool = document.getElementById('pool');
                    const allItems = document.querySelectorAll('.skin-card');
                    allItems.forEach(item => pool.appendChild(item));
                    sortPoolItems(); 
                }, true);
            }
        }

        function sortPoolItems() {
            const pool = document.getElementById('pool');
            const items = Array.from(pool.children);
            items.sort((a, b) => a.getAttribute('data-id').localeCompare(b.getAttribute('data-id')));
            items.forEach(item => pool.appendChild(item));
        }

        window.showModal = function(msgHTML, callbackYes, hasCancel = true) {
            const modal = document.getElementById('confirmModal');
            document.getElementById('modal-msg').innerHTML = msgHTML;
            const btnYes = document.getElementById('modal-yes');
            const btnNo = document.getElementById('modal-no');
            btnNo.style.display = hasCancel ? 'inline-block' : 'none';
            modal.style.display = 'flex';
            
            const newYesBtn = btnYes.cloneNode(true);
            btnYes.parentNode.replaceChild(newYesBtn, btnYes);
            newYesBtn.onclick = function() {
                if (callbackYes) callbackYes();
                window.closeModal();
            };
        }

        window.closeModal = function() {
            document.getElementById('confirmModal').style.display = 'none';
        }

        window.toggleTheme = function() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const icon = document.getElementById('theme-icon');
            if (currentTheme === 'light') {
                body.setAttribute('data-theme', 'dark');
                icon.textContent = 'â˜€ï¸';
            } else {
                body.setAttribute('data-theme', 'light');
                icon.textContent = 'ğŸŒ™';
            }
        }
        
        window.applyTheme = function() {
            document.getElementById('theme-icon').textContent = 'â˜€ï¸';
        }
    </script>
</body>
</html>
