<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arknights Skin Tier List</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        /* --- CSS ë³€ìˆ˜ (í…Œë§ˆ ì‹œìŠ¤í…œ) --- */
        :root {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --panel-bg: #222;
            --item-bg: #2b2b2b;
            --border-color: #444;
            --card-bg: #333;
            --card-border: #555;
            --modal-bg: #2a2a2a;
            --modal-overlay: rgba(0, 0, 0, 0.7);
            --shadow: rgba(0,0,0,0.5);
        }

        /* ë¼ì´íŠ¸ ëª¨ë“œ ë³€ìˆ˜ */
        [data-theme="light"] {
            --bg-color: #f0f2f5;
            --text-color: #333333;
            --panel-bg: #ffffff;
            --item-bg: #e4e6eb;
            --border-color: #ccc;
            --card-bg: #fff;
            --card-border: #bbb;
            --modal-bg: #fff;
            --modal-overlay: rgba(0, 0, 0, 0.3);
            --shadow: rgba(0,0,0,0.1);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background 0.3s, color 0.3s;
        }

        /* --- ìƒë‹¨ í—¤ë” & ì–¸ì–´ ì„¤ì • --- */
        .header-area {
            position: relative;
            width: 100%;
            max-width: 1200px;
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin: 0 0 20px 0;
        }

        /* ì–¸ì–´ ì„ íƒê¸° (ìš°ì¸¡ ìƒë‹¨) */
        .lang-selector {
            position: absolute;
            top: 0;
            right: 0;
        }

        select {
            background-color: var(--panel-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 5px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* --- ì»¨íŠ¸ë¡¤ íŒ¨ë„ --- */
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .btn {
            background-color: var(--panel-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 10px 20px;
            cursor: pointer;
            font-size: 1rem;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .btn:hover { filter: brightness(1.2); }
        .btn-add { background-color: #2e7d32; color: white; border-color: #1b5e20; }
        .btn-reset { background-color: #c62828; color: white; border-color: #b71c1c; }

        /* --- í…Œë§ˆ í† ê¸€ ë²„íŠ¼ (ì¢Œì¸¡ í•˜ë‹¨ ê³ ì •) --- */
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--panel-bg);
            border: 2px solid var(--border-color);
            color: var(--text-color);
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 10px var(--shadow);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- í‹°ì–´ ë¦¬ìŠ¤íŠ¸ --- */
        .tier-container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 50px;
        }

        .tier-row {
            display: flex;
            min-height: 160px;
            background-color: var(--panel-bg);
            border: 1px solid var(--border-color);
            position: relative;
        }

        .tier-label {
            width: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            flex-shrink: 0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            color: #333;
            cursor: text;
        }

        .tier-content {
            flex-grow: 1;
            padding: 10px;
            padding-right: 40px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            background-color: var(--item-bg);
            align-content: flex-start;
            transition: background 0.3s;
        }

        .delete-btn {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 30px;
            background-color: var(--card-bg);
            color: #888;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-left: 1px solid var(--border-color);
        }
        .delete-btn:hover { background-color: #800; color: white; }

        /* --- ëŒ€ê¸°ì—´ (Pool) --- */
        .pool-section {
            width: 100%;
            max-width: 1200px;
            border: 2px dashed var(--border-color);
            padding: 20px;
            background-color: var(--panel-bg);
            transition: background 0.3s;
        }
        
        .pool-title { margin-top: 0; margin-bottom: 15px; color: #888; }

        .item-pool {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            min-height: 200px;
        }

        /* --- ì¹´ë“œ ë””ìì¸ --- */
        .skin-card {
            width: 100px;
            height: 180px;
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            cursor: grab;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 5px var(--shadow);
        }
        .skin-card img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
        .skin-card:hover {
            transform: translateY(-7px) scale(1.02);
            box-shadow: 0 10px 20px var(--shadow);
            border-color: var(--text-color);
            z-index: 10;
        }

        /* --- ì»¤ìŠ¤í…€ í™•ì¸ ëª¨ë‹¬ (Popup) --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--modal-overlay);
            display: none; /* JSë¡œ ì œì–´ */
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(3px);
        }

        .modal-box {
            background-color: var(--modal-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 25px;
            border-radius: 8px;
            width: 300px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .modal-msg { margin-bottom: 20px; font-size: 1.1rem; }

        .modal-actions { display: flex; justify-content: center; gap: 10px; }
        .modal-btn { padding: 8px 20px; border-radius: 4px; border: none; cursor: pointer; font-weight: bold; }
        .modal-btn.confirm { background-color: #c62828; color: white; }
        .modal-btn.cancel { background-color: var(--border-color); color: var(--text-color); }

    </style>
</head>
<body>

    <div class="header-area">
        <h1 id="txt-title">Arknights Skin Tier List</h1>
        <div class="lang-selector">
            <select id="langSelect" onchange="changeLanguage(this.value)">
                <option value="ko">í•œêµ­ì–´</option>
                <option value="en">English</option>
                <option value="jp">æ—¥æœ¬èª</option>
                <option value="cn">ä¸­æ–‡</option>
            </select>
        </div>
    </div>

    <div class="controls">
        <button class="btn btn-add" onclick="addTier()" id="btn-add">+ Add Tier</button>
        <button class="btn btn-reset" onclick="tryReset()" id="btn-reset">Reset</button>
        <button class="btn" onclick="saveImage()" id="btn-save">Save Image (Beta)</button>
    </div>

    <div class="tier-container" id="tier-container"></div>

    <div class="pool-section">
        <h3 class="pool-title" id="txt-pool">Unranked Skins</h3>
        <div class="item-pool" id="pool"></div>
    </div>

    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
        <span id="theme-icon">â˜€ï¸</span>
    </button>

    <div class="modal-overlay" id="confirmModal">
        <div class="modal-box">
            <div class="modal-msg" id="modal-msg">Are you sure?</div>
            <div class="modal-actions">
                <button class="modal-btn confirm" id="modal-yes">Yes</button>
                <button class="modal-btn cancel" onclick="closeModal()">No</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. ì„¤ì • ë° ë°ì´í„° ---
        const pathPrefix = "img/"; 
        const totalImages = 110; 
        const tierColors = ['#ff7f7f', '#ffbf7f', '#ffff7f', '#7fff7f', '#7fbfff', '#7f7fff', '#ff7fff', '#bfbfbf'];
        
        // ì–¸ì–´íŒ©
        const i18n = {
            ko: {
                title: "ëª…ì¼ë°©ì£¼ ìŠ¤í‚¨ í‹°ì–´í‘œ",
                add: "+ í‹°ì–´ ì¶”ê°€",
                reset: "ì´ˆê¸°í™”",
                save: "ì´ë¯¸ì§€ ì €ì¥ (ë² íƒ€)",
                pool: "ëŒ€ê¸°ì—´ (ë“œë˜ê·¸í•˜ì—¬ ì´ë™)",
                confirmReset: "ë°°ì¹˜ëœ ì•„ì´í…œì´ ëª¨ë‘ ëŒ€ê¸°ì—´ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.<br>ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                confirmDelete: "ì´ í‹°ì–´ì— ì•„ì´í…œì´ ìˆìŠµë‹ˆë‹¤.<br>ì‚­ì œ ì‹œ ëŒ€ê¸°ì—´ë¡œ ì´ë™ë©ë‹ˆë‹¤.",
                yes: "í™•ì¸",
                no: "ì·¨ì†Œ"
            },
            en: {
                title: "Arknights Skin Tier List",
                add: "+ Add Tier",
                reset: "Reset",
                save: "Save Image",
                pool: "Unranked Skins",
                confirmReset: "All placed items will return to the pool.<br>Proceed?",
                confirmDelete: "There are items in this tier.<br>They will be moved to the pool.",
                yes: "Yes",
                no: "No"
            },
            jp: {
                title: "ã‚¢ãƒ¼ã‚¯ãƒŠã‚¤ãƒ„ ã‚³ãƒ¼ãƒ‡ Tierè¡¨",
                add: "+ ãƒ†ã‚£ã‚¢è¿½åŠ ",
                reset: "ãƒªã‚»ãƒƒãƒˆ",
                save: "ç”»åƒä¿å­˜",
                pool: "æœªé…ç½®ãƒªã‚¹ãƒˆ",
                confirmReset: "é…ç½®ã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ãŒå…¨ã¦æˆ»ã‚Šã¾ã™ã€‚<br>ç¶šã‘ã¾ã™ã‹ï¼Ÿ",
                confirmDelete: "ã“ã®ãƒ†ã‚£ã‚¢ã«ã‚¢ã‚¤ãƒ†ãƒ ãŒã‚ã‚Šã¾ã™ã€‚<br>å‰Šé™¤ã™ã‚‹ã¨ãƒªã‚¹ãƒˆã«æˆ»ã‚Šã¾ã™ã€‚",
                yes: "ç¢ºèª",
                no: "ã‚­ãƒ£ãƒ³ã‚»ãƒ«"
            },
            cn: {
                title: "æ˜æ—¥æ–¹èˆŸ æ—¶è£… æ¢¯é˜Ÿæ¦œ",
                add: "+ æ·»åŠ å±‚çº§",
                reset: "é‡ç½®",
                save: "ä¿å­˜å›¾ç‰‡",
                pool: "æœªæ’åçš®è‚¤",
                confirmReset: "æ‰€æœ‰å·²æ”¾ç½®çš„ç‰©å“å°†è¿”å›åˆ—è¡¨ã€‚<br>æ˜¯å¦ç»§ç»­ï¼Ÿ",
                confirmDelete: "è¯¥å±‚çº§ä¸­æœ‰ç‰©å“ã€‚<br>åˆ é™¤åå°†ç§»å›åˆ—è¡¨ã€‚",
                yes: "ç¡®è®¤",
                no: "å–æ¶ˆ"
            }
        };

        let currentLang = 'ko';
        let pendingAction = null; // ëª¨ë‹¬ í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰í•  í•¨ìˆ˜ ì €ì¥

        // --- 2. ì´ˆê¸°í™” ë° ì–¸ì–´ ê°ì§€ ---
        window.onload = function() {
            detectLanguage();
            loadImages();
            resetTiers(true); // true = ê°•ì œ ì´ˆê¸°í™” (íŒì—… ì—†ì´)
            applyTheme();
        };

        function detectLanguage() {
            const userLang = navigator.language.slice(0, 2); // 'ko-KR' -> 'ko'
            if (['ko', 'en', 'ja', 'zh'].includes(userLang)) {
                // ja -> jpë¡œ ë§¤í•‘ (ì½”ë“œìƒ í¸ì˜)
                currentLang = (userLang === 'ja') ? 'jp' : (userLang === 'zh') ? 'cn' : userLang;
            } else {
                currentLang = 'en'; // ê¸°ë³¸ê°’
            }
            document.getElementById('langSelect').value = currentLang;
            updateText();
        }

        function changeLanguage(lang) {
            currentLang = lang;
            updateText();
        }

        function updateText() {
            const t = i18n[currentLang];
            document.getElementById('txt-title').textContent = t.title;
            document.getElementById('btn-add').textContent = t.add;
            document.getElementById('btn-reset').textContent = t.reset;
            document.getElementById('btn-save').textContent = t.save;
            document.getElementById('txt-pool').textContent = t.pool;
            document.getElementById('modal-yes').textContent = t.yes;
            // ë‹«ê¸° ë²„íŠ¼ì€ ê³µí†µì´ë¯€ë¡œ HTML onclickìœ¼ë¡œ ì²˜ë¦¬
        }

        // --- 3. ì´ë¯¸ì§€ ë¡œë”© ---
        function loadImages() {
            const pool = document.getElementById('pool');
            pool.innerHTML = '';
            for (let i = 1; i <= totalImages; i++) {
                const number = String(i).padStart(3, '0');
                const card = document.createElement('div');
                card.className = 'skin-card';
                card.innerHTML = `<img src="${pathPrefix}skin_${number}.png" onerror="this.parentElement.style.display='none'">`;
                pool.appendChild(card);
            }
            new Sortable(pool, { group: 'shared', animation: 150 });
        }

        // --- 4. í‹°ì–´ ê´€ë¦¬ ë¡œì§ ---
        function createTierRow(labelText = 'New', colorCode = '#ccc') {
            const container = document.getElementById('tier-container');
            const row = document.createElement('div');
            row.className = 'tier-row';

            const label = document.createElement('div');
            label.className = 'tier-label';
            label.textContent = labelText;
            label.style.backgroundColor = colorCode;
            label.contentEditable = true;

            const content = document.createElement('div');
            content.className = 'tier-content';

            const delBtn = document.createElement('div');
            delBtn.className = 'delete-btn';
            delBtn.innerHTML = 'Ã—';
            
            // ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ ê²€ì¦
            delBtn.onclick = function() {
                if (content.children.length > 0) {
                    showModal(i18n[currentLang].confirmDelete, () => performDelete(row, content));
                } else {
                    performDelete(row, content);
                }
            };

            row.appendChild(label);
            row.appendChild(content);
            row.appendChild(delBtn);
            container.appendChild(row);

            new Sortable(content, { group: 'shared', animation: 150 });
        }

        function performDelete(row, content) {
            const pool = document.getElementById('pool');
            const items = Array.from(content.children);
            items.forEach(item => pool.appendChild(item));
            row.remove();
        }

        function addTier() {
            const container = document.getElementById('tier-container');
            const count = container.children.length;
            const labels = ['S', 'A', 'B', 'C', 'D', 'E', 'F'];
            const nextLabel = labels[count] || String.fromCharCode(65 + count);
            const nextColor = tierColors[count % tierColors.length];
            createTierRow(nextLabel, nextColor);
        }

        // --- 5. ì´ˆê¸°í™” (Reset) ë¡œì§ ---
        function tryReset() {
            // í‹°ì–´ ë¦¬ìŠ¤íŠ¸ ì•ˆì— ì•„ì´í…œì´ í•˜ë‚˜ë¼ë„ ìˆëŠ”ì§€ í™•ì¸
            const itemsInTiers = document.querySelectorAll('.tier-content .skin-card');
            if (itemsInTiers.length > 0) {
                showModal(i18n[currentLang].confirmReset, () => resetTiers(false));
            } else {
                resetTiers(false);
            }
        }

        function resetTiers(force = false) {
            const pool = document.getElementById('pool');
            // ëª¨ë“  ì•„ì´í…œ ë³µê·€
            const allItems = document.querySelectorAll('.skin-card');
            allItems.forEach(item => pool.appendChild(item));

            // í‹°ì–´ ì¬ì„¤ì •
            const container = document.getElementById('tier-container');
            container.innerHTML = '';
            createTierRow('S', tierColors[0]);
            createTierRow('A', tierColors[1]);
            createTierRow('B', tierColors[2]);
        }

        // --- 6. ëª¨ë‹¬ (Popup) ì‹œìŠ¤í…œ ---
        function showModal(msgHTML, callbackAction) {
            const modal = document.getElementById('confirmModal');
            document.getElementById('modal-msg').innerHTML = msgHTML;
            modal.style.display = 'flex';
            
            // 'Yes' ë²„íŠ¼ì— ì¼íšŒì„± ì´ë²¤íŠ¸ ì—°ê²°
            const yesBtn = document.getElementById('modal-yes');
            // ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±° (ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€)
            const newYesBtn = yesBtn.cloneNode(true);
            yesBtn.parentNode.replaceChild(newYesBtn, yesBtn);
            
            newYesBtn.onclick = function() {
                callbackAction();
                closeModal();
            };
        }

        function closeModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }

        // --- 7. í…Œë§ˆ (Dark/Light) ì‹œìŠ¤í…œ ---
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const icon = document.getElementById('theme-icon');

            if (currentTheme === 'light') {
                body.setAttribute('data-theme', 'dark');
                icon.textContent = 'â˜€ï¸'; // ë‹¤í¬ëª¨ë“œì¼ ë•Œ í•´ ì•„ì´ì½˜ (ë°ê²Œ í•˜ê¸°)
            } else {
                body.setAttribute('data-theme', 'light');
                icon.textContent = 'ğŸŒ™'; // ë¼ì´íŠ¸ëª¨ë“œì¼ ë•Œ ë‹¬ ì•„ì´ì½˜ (ì–´ë‘¡ê²Œ í•˜ê¸°)
            }
        }

        function applyTheme() {
            // ê¸°ë³¸ê°’ ë‹¤í¬ëª¨ë“œ (HTML CSS ë³€ìˆ˜ ê¸°ë³¸ê°’)
            document.getElementById('theme-icon').textContent = 'â˜€ï¸';
        }

        function saveImage() {
            alert("ì´ë¯¸ì§€ ì €ì¥ ê¸°ëŠ¥ì€ html2canvas ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.\nì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤!");
        }

    </script>
</body>
</html>
